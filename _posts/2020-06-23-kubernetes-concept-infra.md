--- 
layout: single
classes: wide
title: "[Kubernetes 개념] Kubernetes 와 관련 인프라"
header:
  overlay_image: /img/kubernetes-bg.jpg
excerpt: 'Kubernetes 와 이를 구성하는 인프라의 요소에 대해 알아보자'
author: "window_for_sun"
header-style: text
categories :
  - Kubernetes
tags:
  - Kubernetes
  - Concept
  - Cloud
  - DevOps
  - Container
  - Orchestration
  - Cloud Native
toc: true
use_math: true
---  


## Cloud
오늘날 `Cloud`(클라우드)는 우리에게 익숙하고 편리한 존재이다. 
우리는 컴퓨팅 자원을 공유하는 방식을 `Cloud`라고 부르지만 이러한 개념은 오래전부터 사용하던 방식이다. 
예전에 `메인프레임` 이라는 커다란 컴퓨터를 여러 사람들이 공유해서 사용하고, 
사용한 만큼의 비용을 지불 하는 현시대의 `Cloud`와 비슷한 방법을 사용했었다. 

### 시간에 따른 비용
`Cloud`는 컴퓨터라는 하드웨어를 구매하는 것이 아닌, `컴퓨팅 리소스`를 구매하는 것을 의미한다. 
컴퓨터라는 하드웨어는 확장, 유지보수 측면에서 단점이 존재하기 때문에 `컴퓨팅 리소스`를 구매하고 판매 측에 확장, 유지보수와 같은 작업을 맡기는 것이다. 
`Cloud`는 단순히 임대한 원격 컴퓨터에 국한되지 않고, 클라우드 분산 시스템을 포함한다. 
특정 서비스의 `컴퓨팅 리소스`를 구매해서 소프트웨어를 실행하거나, 원하는 데이터를 저장할 수도 있다. 

### 클라우드 인프라
`클라우드`를 통해 서비스를 제공하면 다양한 인프라를 사용할 수 있다. 
투자 비용과 같은 큰 초기 자본이 필요하지 않고, 물건을 사듯이 `클라우드` 상품을 구매해 구성 할 수 있다. 
이러한 서비스형 인프라(IaaS)를 제공하는 곳을 관리형 서비스라고 하고, 이를 통해 모니터링, 복제, 고가용성등 검증된 서비스를 제공 받을 수 있다. 

## DevOps
먼저 `DevOps`(데브옵스) 란 개발과 운영 두 그룹을 하나로 모으기 위한 시도라고 볼 수 있다. 
클라우드의 등장으로 업무적으로 분리되었던, 개발과 운영에 변화가 생기게 되었다. 
분산 시스템은 복잡하고 장애 복구, 업데이트와 같은 시스템 운영 기술은 클라우드시스템의 설계 및 구현, 아키텍쳐와 분리가 쉽지 않다. 
서비스를 제공하는 하나의 시스템은 단순한 소프트웨어를 벗어나 사내 소프트웨어, 클라우드 서비스, 로드 밸런서, 모니터링, 배포 등 다양한 구성이 포함되기 시작한다. 
이는 즉 소프트웨어를 작성하는 개발자와 이를 운영하는 시스템이 밀접하게 연결되어 상호 의존적인 관계로 거듭나게 되었다. 
소프트웨어 개발자는 자신이 작성하는 소프트웨어가 이를 구성하는 시스템과의 어떠한 관계가 있는지 이해해야 하고, 
시스템 관리자는 반대로 구성된 소프트웨어의 동작과 관계 및 실패 상황에 대해 이해할 필요가 생긴 것이다. 
기존에 분리되었던 두 그룹사이에 밀접한 의존성이 생긴만큼 서로 협업하고 공유하며, 
전체적인 시스템과 소프트웨어의 책임을 공유해서 안정성과 확장성을 향상시키기 위한 시도이다. 

## DevOps 란 무엇인가
`DevOps` 와 관련해서 논쟁이 발생하곤 한다.
- `DevOps` 는 기본 소프트웨어 개발에 존재하던 `모범 사례`의 현대적인 이름일 뿐이다.
- 개발과 운영 사이의 협업의 필요성에 대한 거부로 `DevOps` 를 거부한다.

`DevOps` 가 실제로 무엇인가에 대해서는 아래와 같은 질문을 던질 수 있다.
- `DevOps` 는 직무인가 ?
- `DevOps` 는 팀인가 ?
- `DevOps` 는 방법론인가 ?
- `DevOps` 는 기술의 집합인가 ?

`DevOps` 에 대한 글을 쓰는 존 윈리스는 관련 핵심을 아래와 같이 4가지 `CAMS`로 정의한다.
- 문화(Culture)
- 자동화(Automation)
- 측정(Measurement)
- 공유(Sharing)

브라이언 도슨이 정의한 `DevOps` 의 삼위일체는 아래와 같다.
- 사람과 문화
- 과정과 실천
- 도구와 기술

다른 의견으로 클라우드와 컨테이너의 환경에서는 더이상 `DevOps` 는 필요하지 않다고 주장하는 `NoOps` 도 있다. 
즉 이는 시스템 인프라관련 업무는 클라우드 업체로 부터 아웃소싱 되기 때문에, 사내에 별도의 직원은 필요하지 않다는 의견이다. 
`DevOps` 에 대한 이해를 돕기위해 조던 바흐의 말을 빌리면 아래와 같다. 
> 데브옵서를 하면 코드가 사용 환경에 도달하기 전에 전통적인 IT 운영 작업의 상당수가 수행된다. 
모든 릴리즈는 모니터링, 로딩, A/B 테스트를 포함한다. 
CI/CD 파이프라인은 모든 커밋에 대해 유닛 테스트, 보안 스캐너, 정책 검사를 자동으로 수행한다. 
배포는 자동으로 수행된다. 
제어, 작업, 비기능적 요구 사항은 이제 릴리즈 전에 구현되어 심각한 운영 중단의 여파를 대신한다.

### DevOps 의 장점
비지니스 관점에서 본다면 `DevOps` 는 클라우드 자동화를 통해 릴리즈 주기를 단축하고, 소프트웨어 품질을 향상시키는 것과 소프트웨어가 상용환경에서 상시 운영될 수 있다는 점에 있다. 
이러한 방식은 신속하게 소프트웨어를 개발하고 실패와 문제에 더 빠르게 대응할 수 있을 뿐만아니라, 시장에 더 민첩한 대응을 통해 품질 항샹을 기대할 수 있다.  

클라우드 환경을 전제로 한다면 시스템 또한 하나의 소프트웨어로 볼 수 있다. 
`DevOps` 는 소프트웨어 개발 기술을 운영에 도입하는 것을 의미한다.
복잡하게 구성된 시스템을 소프트웨어를 통해 신속하고 협력적으로 구축하는 `코드형 인프라` 를 활용할 수 있다. 
클라우드 인프라를 통해 소프트웨어 형태로 인프라를 자동으로 공급 및 조정이 가능하게 되었다.  

또한 개발, 운영팀은 협력을 통해 시스템을 설계 및 구축하고 상용 시스템을 모니터링을 하며 개선점을 함께 고민할 수 있다. 
이러한 움직임은 협력과 코드 중심을 통해 운영을 소프트웨어 문제로 바꾸었고, 클라우드와 `DevOps` 의 관점에서 아래와 같은 질문을 던질 수 있다. 
- 서로 다른 서버 아키텍쳐와 운영체제의 다양한 네트워크에서 소프트웨어를 배포하고 업그레이드 하는 방법은 무엇인가 ?
- 표준화된 구성 요소를 활용하여 안정적이고 재현 가능한 방식으로 분산 환경에 배포하는 방법은 무엇인가 ?

## Container
하나의 서비스를 구현한 소프트웨어를 배포한다면 아래와 같은 의존성이 필요하다.
- 라이브러리
- 인터프리터
- 서브 패키지
- 컴파일러
- 설정
- 메타정보

가장 간단한 방법은 자체 패키징을 통해 구성할 수 있다. 
하지만 이러한 방법은 해당 언어에 종속되고 의존성에 대한 문제는 여전히 남아 있다.  

다른 방법으로는 `옴니버스 패키지` 이다. 
애플리케이션에 필요한 모든 것을 단일 파일에 구성하는 방법을 의미한다. 
자바로 예를들면 자바 런타임 뿐만아니라 애플리케이션의 JAR 파일을 모두 포함시키는 방법이다. 

더 나아가 애플리케이션에 필요한 전체 시스템을 `가상 머신 이미지` 로 제공하는 방법도 있다. 
하지만 이는 이미지의 크기가 방대해 지고 구축와 유지보수에도 큰 어려움을 가져다 줄 수 있다. 
또한 이미지가 커지는 만큼 배포 속도나 성능 및 리소스 측면에서도 비효율적이다. 

서두가 길었지만 이러한 문제점을 해결할 수 있는 방법이 바로 `Container` 이다. 
`Container` 에는 애플리케이션 실행에 필요한 모든 것이 포함되어 있고, 컨테이너 런다임이 실핼 할 수 있는 이미지 파일에 저장한다. 
가상 머신 이미지와의 차이점은 이미지의 크기이다. 
가상 머신 이지미는 대부분 `1GiB` 정도 되지만 컨테이너는 매우 작다. 
가상 머신에는 불필요한 프로그램, 라이브러리 등이 포함되어 있지만 `Container` 이러한 부분을 모두 제거해 낭비되는 공간을 최소화 한다.  

또한 `Container` 는 가성 머신 이미지처럼 가상 환경에서 동작하는 것이 아니라, 일반적인 바이너리 실행 파일과 동일하게 가상화의 오버헤드 없이 실행된다. 
`Container` 는 아래와 같은 의미로 사용 될 수 있다.
- 배포 및 패키징의 단위
- 재사용 단위
- 스케일링 단위
- 리소스 할당 단위

`Container` 가 의존하는 것은 운영체제 커널밖에 없다. 
그리고 `Container` 이미지를 통해 애플리케이션을 제공하면 표준 컨테이너 형식을 지원하고 호환되는 플랫폼에서 실행 가능하다.  

쿠버네티스 개발자 브렌던 번스와 데이비드 오펜하이머는 `Container` 에 대해 아래와 같이 설명한다.
>컨테이너는 밀폐된 상태로 봉인되어 의존성을 전달하며 배포 신호(성공/실패)를 제공하여 데이터 센터나 클라우드 소프트웨어 배포 기술을 크게 개선했다. 
하지만 컨테이너는 더 나은 배포 수단 이상이 될 가능성이 있다. 
우리는 컨테이너가 객체지향 소프트웨어 시스템의 객체와 유사해져서 분산 시스템 디자인 ㅐㅍ턴을 개발할 수 있을 것으로 기대한다. 

## Container Orchestration
`Container Orchestration` 은 다양한 머신을 하나의 클러스터로 결합하도록 설계된 소프트웨어의 일종이다. 
또한 아래와 같은 종류의 역할을 담당하는 서비스를 의미한다.
- 스케줄링
- 오케스트레이션
- 클러스터 관리

## Kubernetes
구글은 오래전 부터 상용 워크로드를 위해 대규모 컨테이너를 운영하고 있었다. 
우리가 모든 구글의 서비스는 컨테이너를 통해 제공된다. 
처음에 구글은 보그(Borg) 라는 내부 컨테이너 오케스트레이터를 개발해 사용 중에 있었다. 
2014년 구글은 `Kubernetes` 오픈 소스 프로젝트를 시작으로 지금의 대중성을 얻게 되었다. 

### Kubernetes 의 특징
쿠버네티스 커뮤니티의 전설인 켈시 하이타워는 아래와 같이 쿠버네티스를 설명한다.
>쿠버네티스는 자동화, 장애 조치, 중앙 집중식 로깅, 모니터링 같이 최고의 시스템 관리자가 수행하는 작업을 한다. 
또한 우리가 데브옵스 커뮤니티에서 배운 것을 반영하여 기본 작동으로 정의한다. 

이렇게 쿠버네티스는 전통적인 시스템 관리자가 수행해야하는 작업들을 자동화해주어 팀이 핵심 작업에 집중 할 수 있도록 해준다. 
기분족으로 로드 밸런싱, 오토스케일링의 일부는 기본 기능으로 제공한다. 
다른 기능은 쿠버네티스 API 를 통해 애드온, 확장, 서드 파티 도구를 통해 제공된다.  

쿠버네티스는 기본적으로 롤링 어베이트로 무중단 배포를 제공한다. 
그외에도 카나리아 배포, 블루/그린 배포 등도 제공하고 있다.  

그리고 오토스케일링을 통해 급증하는 요청을 새로운 레플리카를 통해 해결가능하다. 
다시 요청이 감소하면 안정적인 수준까지 레플리카를 조정할 수도 있다. 
이를 통해 애플리케이션의 안전성과 탄력성을 제공하여 비용적인 측면에서도 이점이 있다.  

그렇다고 애플리케이션의 모든 구성요소를 쿠버네티스 기반으로 해야하는 것은 아니다. 
특히 데이터베이스와 같은 저장소 성격을 띄는 시스템의 경우가 그렇다. 
이와 관련해 숀 로젤의 말을 빌리면 아래와 같다.
>컨테이너의 소프트웨어 오케스트레이션은 상호 교환 없이 호환 가능한 새로운 인스턴스를 스핀 업 하는 것이 포함된다. 
하지만 데이터베이스 레플리카는 서로 호환되지 않는다. 
데이터베이스는 고유한 상태를 갖고 있으며 데이터베이스 레플리카를 배포하려면 다른 노드와의 조정이 필요하고 동시에 스키마 변경과 같은 작업이 모든 곳에서 수행되어야 한다. 

## Cloud Native
`Cloud Native` 는 오픈 소스 소프트웨어 기반의 클라우드, 컨테이너, 오케스트레이션을 활용한 애프릴케이션과 서비스에 대한 용어이다. 
클라우드 네이티브는 아래와 같은 특징을 같는다.  

- 자동화 : 자동으로 애플리케이션을 배포하고 관리해야 한다.
- 유비쿼터스와 유연성 : 컨테이너를 통한 마이크로서비스는 한 노드에서 다른 노드로 또는 한 클러스터에서 다른 클러스터로 쉽게 이동 가능해야 한다. 
- 탄력성과 확장성 : 클라우드 네이티브 애플리케이션은 분산을 전제로 하기 때문에 다중화나 우아한 성능 저하로 고가용성을 보장해야 한다. 
- 역동성 : 쿠버네티스와 같은 오케스트레이터를 통해 사용 가능한 최대한의 리소스를 활용할 수 있도록 컨테이너를 스케쥴링 해야 한다. 
또한 고가용성에 대한 보장과 무중단을 통해 원활한 업데이트가 가능해야 한다. 
- 관측가능성 : 모니터링, 로깅, 추적, 메트릭 등을 통해 전체적인 시스템 작동 상태와 장애 상태 파악하는데 도움이 될 수 있도록 구성해야 한다. 
- 분산 : 애플리케이션을 모놀리식 형태로 배포하는 것이 아닌, 독립적으로 분리된 역할을 합쳐 하나의 애플리케이션을 구성하는 분산 마이크로서비스를 구성해야 한다. 


---
## Reference
[쿠버네티스를 활용한 클라우드 네이티브 데브옵스: 클라우드 환경에서 모던 애플리케이션 빌드, 배포, 스케일링하기](https://play.google.com/store/books/details/%EC%A1%B4_%EC%96%B4%EB%9F%B0%EB%93%A4_%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4%EB%A5%BC_%ED%99%9C%EC%9A%A9%ED%95%9C_%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C_%EB%84%A4%EC%9D%B4%ED%8B%B0%EB%B8%8C_%EB%8D%B0%EB%B8%8C%EC%98%B5%EC%8A%A4?id=_p_HDwAAQBAJ&hl=ko)
