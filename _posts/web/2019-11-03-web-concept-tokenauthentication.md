--- 
layout: single
classes: wide
title: "[Web 개념] Token 기반 인증"
header:
  overlay_image: /img/web-bg.jpg
excerpt: '토큰 기반 인증에 대해 알아보자'
author: "window_for_sun"
header-style: text
categories :
  - Web
tags:
    - Web
    - Token
    - Authentication
    - JWT
---  

## 헤더 기반 인증
- 가장 보안이 낮은 방법으로 인증에 필요한 정보를 헤더에 넣는 방식이다.
- 데이터 요청시마다 헤더에 사용자 인증 정보가 포함되어 있기 때문에, 보안상 아주 취약하다.
- 프로토타입, 개발 단계에서 사용하기에 적합하다.

## 서버 기반 인증(Session, Cookie)
- 로그인이라는 시점에 사용자 인증 정보를 서버로 보내 인증을 수행하고 고유한 아이디를 발급해준다.
	- 인증에 대한 정보을(Session) 저장 저장소에(DB..) 저장해서 반복적으로 사용할수 있도록 한다.
- 서버 기반 인증에 대한 대략적인 플로우는 아래와 같다.
	1. 클라이언트 - 로그인 요청 -> 서버
	1. 서버 - 인증처리 - 세션 생성 및 저장 - 고유 ID 응답 -> 클라이언트
	1. 클라이언트 - 고유 ID를 담아 요청 -> 서버
	1. 서버 - 고유 ID 검증 - 상태 업데이트 - 요청 응답 -> 클라이언트
- 클라이언트는 이후 요청 부터는 고유 아이디를 사용한다.
- 서버 기반 인증은 서버가 사용자의 상태를 가지고 있으므로 `Stateful` 하다.

### 문제점
#### 세션
- 로그인 동작에서 인증이 된 클라이언트의 상태를 저장소에 저장해야 하므로 추가적인 저장소가 필요하다.
- 사용자가 늘어날수록 이러한 저장소에 대한 부담 또한 늘어난다.
- 지속적인 유저 상태 유지에 따른 부담도 발생할 수 있다.

#### 확장성
- 유저에 대한 상태 정보를 저장하므로 확장성에 제약이 있다.
- 만약 세션 정보를 서버 메모리에 저장했을 경우, 다른 서버로 유저가 요청을 하게 되면 다시 인증이 필요하다.

#### CORS(Cross-Origin Resource Sharing)
- 웹 애플리케이션에서 세션에 대한 쿠키는 단일 도메인, 서브 도메인에서만 동작하기 때문에, 이에 따른 제약이 발생한다.

## 토큰 기반 인증(JWT)
- 토큰 기반 인증은 서버가 인증을 한 토큰을 지속적으로 이용하는 방식이다.
- 유저 상태 정보를 저장하지 않기 때문에 `Stateless` 하다.
- `서버 기반 인증` 에서 발생했었던 문제점들이 해결될 수 있다.
- `토큰` 은 단순한 문자열이 아닌 인증, 인가에 대한 정보와 별도의 정보까지 포함될 수 있다.
- 토큰 기반 인증에 대한 대략적인 플로우는 아래와 같다.
	1. 클라이언트 - 로그인 요청 -> 서버
	1. 서버 - 인증처리 - 토큰 발급 -> 클라이언트
	1. 클라이언트 - 토큰을 담아 요청 -> 서버
	1. 서버 - 토큰 검증 - 요청 응답 -> 클라이언트
	
### 특징
#### Stateless(무상태) 과 Scalability(확장성)
- 무상태성은 토큰 기반 인증에서 중요한 속성이다.
- 서버는 토큰을 발급만 해주고 저장은 클라이언트에 하기 때문에, 서버 확장에도 용이하다.

#### 플랫폼간 공유(Extensibility)
- 대표적으로 OAuth 가 있다.
- 구글, 페이스북 등 계정을 통해 다른 웹서비스에서 로그인할 수 있다.

#### 보안성
- 클라이언트가 더 이상 쿠키를 보낼 필요가 없어지기 때문에, 쿠키를 사용하며 발생했었던 보안 이슈들을 해결할 수 있다.
	- 토큰을 사용하며 발생하는 보안 이슈에 대해서는 추후에 기술한다.
	
#### 모바일 애플리케이션
- 서버 기반 인증을 사용할때 쿠키 매니저를 이용해서 관리를 해야한다.
- 토큰 기반 인증을 사용하면 웹 요청 API 헤더에 토큰을 넣어 사용하면 되기 때문에 쿠키를 사용할 필요가 없어, 모바일 애플리케이션에 적합하다.

#### CSRF (Cross-Site Request Factory) 사이트 간 요청 위조 방지
- 쿠키는 클라이언트 사이드에 저장되기 때문에 노출되기 쉽다.
- 노출된 쿠키를 통해 비밀번호 변경, 회원 탈퇴 등을 수행하면, 서버는 노출된 쿠키는 유효하기 때문에 요청을 수행할 수있다.
- 토큰 기반인증은 헤더에 토큰이 포함되기 때문에 CSRF 를 방지할 수 있다.

#### CORS (Cross-Origin Resource Sharing)
- 쿠키는 기본적으로 단일 도메인, 서브 도메인에서 동작하기 때문에, 여러 도메인을 사용할 경우 관리가 어렵다.
- 토큰 기반 인증은 유효한 토큰이라면 어느 도메인이든지 사용할 수 있다.

#### 토큰 인증 방식의 문제
- 발급된 토큰은 만료시킬 수 없기 때문에 토큰을 이용해서 서버에 무한정 요청을 할 수 있다.
- 이런 문제점을 해결하기 위해 Access Token 을 발급할 때 Refresh Token 을 함께 발급한다.
- 주기가 짧은 Access Token 이 만료되게 되면, 비교적 주기가 간 Refresh Token 을 통해 새로운 토큰을 발급 받도록 한다.

#### 토큰 저장에 따른 문제점
- 클라이언트가 토큰을 받게 되면 localStorage, sessionStorage 에 저장하게된다.
- 이러한 저장소는 비교적 쉽게 노출 될 수 있다.


---
## Reference
[[JWT] 토큰(Token) 기반 인증에 대한 소개](https://velopert.com/2350)  
[서버 기반 인증, 토큰 기반 인증 (Session, Cookie / JSON Web Token)](https://dooopark.tistory.com/6)  
[토큰 기반 인증 간단 정리 Token based Authentication](https://blog.msalt.net/251)  
[세션 기반 인증 방식과 토큰 기반 인증(JWT)](https://yonghyunlee.gitlab.io/node/jwt/)  