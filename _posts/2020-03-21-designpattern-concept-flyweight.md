--- 
layout: single
classes: wide
title: "[DesignPattern 개념] Flyweight Pattern"
header:
  overlay_image: /img/designpattern-bg.jpg
excerpt: ''
author: "window_for_sun"
header-style: text
categories :
  - Design Pattern
tags:
  - Design Pattern
  - Flyweight
use_math : true
---  

## Flyweight 패턴이란
- `Flyweight` 는 권투에서 가장 체중이 가벼운 체급을 의미하는 것처럼, 객체를 가볍게 구성할 수 있도록 해주는 패턴이다.
- 여기서 객체를 가볍게라는 의미는 객체를 생성하기 위해 소비되는 메모리의 사용용량을 의미한다.
- `Flyweight` 는 같은 종류의 객체가 많은 곳에서 사용될 때 유용하게 사용될 수 있다.
- Java 에서는 `new` 를 통해 객체의 인스턴스를 생성하게 되면 필요한 만큼 메모리가 할당된다.
- 객체를 가볍게 만들어 메모리 사용량을 줄이는 방법은 객체의 인스턴스를 가능한 공유시켜 불필요한 `new` 연산을 최소화 시키는 것이다.
 
### 패턴의 구성요소

![그림 1]({{site.baseurl}}/img/designpattern/2/concept_flyweight_1.png)

- `Flyweight` : 메모리 절약을 위해 인스턴스를 공유하고 싶은 객체를 나태내는 클래스이다.
- `FlyweightFactory` : `Flyweight` 의 실제 인스턴스를 생성하고, 이미 생성된 인스턴스의 공유를 관리하는 클래스이다.
- `Client` : `FlyweightFactory` 를 사용해서 `Flyweight` 인스턴스를 얻고, `Flyweight` 를 통해 동작을 수행하는 클래스이다.

### 인스턴스가 공유 될때 주의할 점
- `Flyweight` 패턴은 인스턴스의 공유를 통해 메모리의 사용량을 최적화한다.
- 인스턴스가 공유된다는 부분은 일반적으로 객체를 `new` 를 통해 인스턴스를 생성해 사용할 때와 비교해서 주의해야할 점이 있다.
- 공유되는 인스턴스를 변경하게 되면, 그 인스턴스를 사용하는 모든 부분에 영향이 가게 된다.
- 이러한 주의점으로 `Flyweight` 패턴을 설계할 때는 구현사항에 알맞게 `공유`가 되야하는 부분만 `Flyweight` 로 취급해야 한다.
	- 공유 시켜야할 부분과 공유 시키면 안되는 구분해야 한다.

### Intrinsic 과 Extrinsic
- `인스턴스가 공유 될때 주의할 점` 에서 설명했던 공유 시켜야 할 부분과 공유 시키지 말야아 하는 부분을 `intrinsic` 과 `extrinsic` 라고 한다.
- `intrinsic` 한 정보는 본질적인이라는 의미로, 인스턴스의 정보 중 변하지 않는 정보, 상태에 의존하지 않는 정보를 의미한다.
	- 장소나 상황에 의존하지 않기 때문에 공유할 수 있다.
- `extrinsic` 한 정보는 비본질적인이라는 의미로, 인스턴스의 정보 중 상황에 따라서 변하는 정보, 상태에 의존하는 정보를 의미한다.
	- 장소나 상황에 의존하기 때문에 공유할 수 없다.

### 공유 인스턴스와 Garbage Collection
- `Flyweight` 패턴에서 인스턴스를 공유시키기 위해 특정 저장소에 인스턴스를 모아 저장하게 된다.
- 이때 Java 의 메모리를 관리하는 `garbase collection` 의 대상에 공유되는 인스턴스는 포함되지 않는다는 점을 유의해야 한다.
- `garbase collection` 은 `new` 를 통해 인스턴스를 생성할 때 메모리를 확보하고, 메모리가 부족하게 되면 메모리 공간(Heap 영역)을 조사해 사용되지 않는 인스턴스의 메모리를 해제해서 메모리 공간을 확보한다.
- `grabase collection` 는 인스턴스가 외부에서 참고하고 있으면 사용중이라고 판별하고 그렇지 않다면 사용하고 있지 않다고 판별해서 메모리를 해제시킨다.
- 공유되는 인스턴스는 공유를 위해 외부의 참조가 있기 때문에 `garbase collection` 의 대상이 되지 않는다.

### 기타
- 인스턴스를 공유하는 `new` 의 동작 횟수를 줄일 수 있기 때문에, 메모리 뿐만 아니라 `new` 를 수행할때 소요되는 시간도 줄일 수 있다.
- 특정 상황에서는 인스턴스를 공유하는 것이 독이 될 수도 있다.
	- 불필요하게 많은 인스턴스를 공유하는 경우
	- 사용가능한 메모리의 대부분이 공유 인스턴스로 사용되는 경우

## 버스 탑승 인원 카운트
- 버스는 많은 사람들이 이용하는 대중교통이고, 여러 정류장에서 같은 버스가 다니기도 하고 다른 버스가 다니기도 한다.
- 버스 정류장에서는 각 버스에 탑승하는 인원을 버스의 번호를 기준으로 카운트한다.
- 각 버스 정류장에서 같은 번호를 가진 버스의 카운트는 공유 된다.




---
## Reference

	